<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>Vision-preview</title>
<script src="js/config.js"></script>
<script src="js/chat_vision_api.js"></script>
</head>
<body>
<h1>Vision-Preview</h1>
<button id="ask_button" onclick="askAboutImage()">Ask</button>
</body>
<script>
  // ==== global context ===
  let gptCtx = null;

  // ---- try gpt4-vision-preview ---
  async function askAboutImage() {
    const imageUrl = 'https://mganeko.github.io/visual_sonar/img/palmtree.jpg';

    // --- send image to GPT ---
    const text = 'What is this? Please answer in Japanese.';
    const options = { temperature: 0 };
    const response = await singleChatWithImage(imageUrl, text, gptCtx, options);
    console.log('====== answer ======');
    console.log(response);
  }

  // --- initalize option ---
  function buildInitOptions() {
    const options = {};
    if (API_URL && API_URL.length > 0) {
      options.url = API_URL;
    }
    if (MODEL_NAME && MODEL_NAME.length > 0) {
      options.model = MODEL_NAME;
    }
    if (SEND_TOKEN_LIMIT && SEND_TOKEN_LIMIT > 0) {
      options.sendTokenLimt = SEND_TOKEN_LIMIT;
    }

    return options;
  }


  // --- init Gpt context ---
  const options = buildInitOptions();
  //console.log('option for INIT:', options)
  gptCtx = initChat(API_KEY, options); // Chatを初期化し、GPTコンテキストを保持する

</script>
</html>